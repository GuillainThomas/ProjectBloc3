@page "/admin/impersonate"
@using ProjetBloc3.Business.Applicatif.Security
@using ProjetBloc3.Business.Metier
@using ProjetBloc3.Security.Configuration
@using ProjetBloc3.Repository.BlocCube3.Models
@using Microsoft.AspNetCore.Authorization
@inject NavigationManager NavigationManager
@inject IUserServiceApp UserServiceApp


@attribute [Authorize(Roles = Roles.Admin + "," + Roles.Impersonate)]

<MudGrid>
    <MudItem xs="12" Class="mt-5 mb-3">
        <MudText Typo="Typo.h3">Se connecter en tant que :</MudText>
    </MudItem>
    <MudItem xs="12" Class="mt-5 mb-3">
        <MudDataGrid T="UserAccount" Items="@listAllUser" Class="mt-10" RowClick="(user) => ConnectAs(user.Item)" Dense Hover>
            <Columns>
                <PropertyColumn Property="x => x.UserName" Title="Login" />
                <PropertyColumn Property="x => x.UserRole.Name" Title="Role" />
            </Columns>
        </MudDataGrid>
    </MudItem>
</MudGrid>

@code {
    List<UserAccount> listAllUser = new();

    protected override async Task OnInitializedAsync()
    {
        listAllUser = await UserServiceApp.GetAllUserAccount();
    }

    private void ConnectAs(UserAccount user)
    {
        NavigationManager.NavigateTo("/login/" + user.UserName, true);
    }
}
